---
title: "time-binning"
author: "jt-miller"
date: "2023-11-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Assessing the Data's temporal distribution in order to inform phenology analysis 
Load Libraries
```{r}
library(data.table)
library(lubridate)
library(ggplot2)
library(dplyr)
```
Bring in the Sonoran Flowering Data (cleaned in data-cleaning.Rmd)
```{r}
sonoran_flowering_data <- fread("/home/jt-miller/Gurlab/sliding-phenology/data/processed/flowering_sonoran_data.csv")
cch2_fl_sonoran_data <- fread("/home/jt-miller/Gurlab/sliding-phenology/data/processed/cch2_fl_sonoran_data.csv")
```

Merge Datasets 
```{r}
# Add a field denoting aggregator
sfd <- sonoran_flowering_data[, aggregator := "inat"] 
cch2 <- cch2_fl_sonoran_data[, aggregator := "cch2"]

# Assure correct date class in the cch2 data
cch2$eventDate <- as.Date(cch2$eventDate)

fl_data <- bind_rows(sfd, cch2) # dplyr function that rbinds the data, and replaces NAs for fields missing from eachothers dataset
```


Parse out year month day and day of year (doy) fields
```{r}
fld <- fl_data[, year := year(as.POSIXct(eventDate, format = "%Y-%m-%d %H:%M:%S %Z"))]
fld <- fl_data[, month := month(as.POSIXct(eventDate, format = "%Y-%m-%d %H:%M:%S %Z"))]
fld <- fl_data[, day := day(as.POSIXct(eventDate, format = "%Y-%m-%d %H:%M:%S %Z"))]
fld <- fl_data[, doy := yday(as.POSIXlt.POSIXct(eventDate, format = "%Y-%m-%d %H:%M:%S %Z"))]


fld[, (.N), by = "year"] # Looks like very few records prior to the 2000s, ask Rob but as an arbitrary cut off lets go from there
class(fld$year)
fld <- fld[year >= 1950]
```

First, phenology density mapping over full time scale 
```{r}
ggplot(fld, aes(x = year)) +
  geom_density(fill = "skyblue", alpha = 0.5) +
  labs(title = "Density Time Series of Observations per Year",
       x = "Year",
       y = "Density") +
  theme_minimal()

ggplot(fld, aes(x = factor(year))) +
  geom_bar(fill = "skyblue") +
  labs(title = "Number of Records per Year",
       x = "Year",
       y = "Density") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```



